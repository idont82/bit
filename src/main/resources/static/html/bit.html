<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1400, initial-scale=1">
    
    <title>BIT</title>
  	<meta name="description" content="삼삼엠투 사이트의 예약현황을 간편히 조회할 수 있습니다.">
  	
	<!-- https://getbootstrap.kr/ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	
	<link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.min.css" />
	<link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.bootstrap5.css" />
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.2.3/css/buttons.bootstrap5.css" />
	
	<script src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>
	<script src="https://cdn.datatables.net/2.3.2/js/dataTables.bootstrap5.js"></script>
	<script src="https://cdn.datatables.net/buttons/3.2.3/js/dataTables.buttons.js"></script>
	<script src="https://cdn.datatables.net/buttons/3.2.3/js/buttons.bootstrap5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
	<script src="https://cdn.datatables.net/buttons/3.2.3/js/buttons.html5.min.js"></script>
	

	<script src="/js/common.js"></script>

    <style>
    	header {
		    padding-top: 7.5rem;
		    padding-bottom: 4rem;
		}
		.img_room {
		    width: 100%;
		    height: 90px;
		    margin-top: 1rem;
		}
    </style>
</head>

<body>

	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
        <div class="container px-4">
            <a class="navbar-brand" href="#page-top">BIT</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    
                    <li class="nav-item"><a class="nav-link" href="#services">Search</a></li>
                    <li class="nav-item"><a class="nav-link" href="#div_mapArea">Map</a></li>
                </ul>
            </div>
        </div>
    </nav>
    
    <header class="bg-primary bg-gradient text-white">
            <div class="container px-4 text-center">
                <h1 class="fw-bolder">Welcome</h1>
                <p class="lead"></p>
                <a class="btn btn-dark" href="mailto:﻿idont82@gmail.com">Request a question by email</a>
             </div>

    </header>
        
	<div class="container mt-5   mb-5">
	  	
	  	<div class="row g-3 align-items-center mt-5">
			<span></span>
		</div>
		
	  	<div id="services" class="row g-3 align-items-center">
	  		
	  		<div  class="col-auto">
	  			<div class="input-group ">
					<label class="input-group-text" for="inputGroupSelect01">단위</label>
					<select id=sel_candlesType class="form-select" id="inputGroupSelect01">
						<option value="minutes" selected>분</option>
						<option value="days">일</option>
						<option value="weeks">주</option>
						<option value="months">월</option>
					</select>
				</div>
				
			</div>
			<div  class="col-auto">
	  			<div class="input-group ">
					<label class="input-group-text" for="inputGroupSelect02">분단위</label>
					<select id="sel_minutes" class="form-select" id="inputGroupSelect02">
						<option value="1" selected>1분</option>
						<option value="3" selected>3분</option>
						<option value="5" selected>5분</option>
						<option value="10" selected>10분</option>
						<option value="15" selected>15분</option>
						<option value="30" selected>30분</option>
						<option value="60" selected>1시간</option>
						<option value="240" selected>4시간</option>
					</select>
				</div>
				
			</div>
		  	<div class="col-auto">
		  		<div class="input-group ">
					<label class="input-group-text" for="inputGroupSelect03">갯수</label>
					<select id="sel_count" class="form-select" id="inputGroupSelect03">
						<option value="50" selected>50개</option>
						<option value="100">100개</option>
						<option value="200">200개</option>
					</select>
				</div>
			</div>
			<div class="col">
				<span>최근 </span>
			</div>
			<div class="col-auto">
				<span> 최근업데이트 : </span><span id="label_last"></span>
			</div>
		</div>
		
	
	
		<div class="row mt-5">
			<table id="myTable" class="display">
			    <thead>
			    </thead>
			    <tbody>
			    </tbody>
			</table>
		</div>
		

	</div>
  
  	<!-- toast -->
  	<div class="toast-container position-fixed bottom-0 end-0 p-3">
	  <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="10000">
	    <div class="toast-header">
	      <svg aria-hidden="true" class="bd-placeholder-img rounded me-2" height="20" preserveAspectRatio="xMidYMid slice" width="20" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="#007aff"></rect></svg>
	      <strong class="me-auto">Message</strong>
	      <!--<small>11 mins ago</small>-->
	      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
	    </div>
	    <div class="toast-body">
	    </div>
	  </div>
	</div>
	
    <script>
    
    const toastLive = document.getElementById('liveToast');
    const toastBootstrap  = bootstrap.Toast.getOrCreateInstance(toastLive);
    const bit = {};
    
    toastMsg = function(str){
		$('.toast-body').text(str);
		toastBootstrap.show();
    }	
    
    $(document).ready(function() {
    	
        //조회
        bit.selectAll();
        
        bit.selectCaution();
    	
    });
    
    
    const MONTH_CNT = 3; //3개월
	let months = [];
    
    bit.selectAll = function(){	

    	const options = {method: 'GET', headers: {accept: 'application/json'}};

    	fetch('https://api.bithumb.com/v1/market/all?isDetails=true', options)
    	  .then(response => response.json())
    	  .then(response => bit.loop(response))
    	  .catch(err => console.error(err));
    	
	
    };
    
    bit.loop = function(response){
		
    	//1)테이블 생성
    	var table = $('#myTable').DataTable(
    			{ data: response,
    			pageLength: 500,
    			"columns": [
    					{ "data": "checkbox", title : "check" }, 
    		            { "data": "market" , title : "market"}, 
    		            { "data": "korean_name" , title : "korean" }, 
    		            { "data": "english_name" , title : "english"},
    		            { "data": "market_warning", title : "warning" }
    		      ],
    		    "columnDefs": [
    		            {
    		                "targets": 0, // 첫 번째 열
    		                "orderable": true,
    		                "render": function (data, type, row) {
    		                    return '<input type="checkbox" class="row-select" data-id="' + row.id + '" ' + (data == null || !data.selected ? '' : 'checked') + '>';
    		                }
    		            }
    		        ],
				}
    	);
    	
		$('#myTable tbody').on('click', 'tr', function() {
			        // 클릭된 행(<tr>)의 데이터를 가져옵니다.
			        var data = table.row(this).data();

			        if (data) { // data가 유효한 경우에만 실행
			        	bit.selectCandles(data.market, $('#sel_candlesType').val(), $('#sel_minutes').val(), $('#sel_count').val());
			        }
		});
    	  
    	console.log(response);
    	return;
    	
    	//2)시세
        let index = 0;

        function callNext() {
            if (index >= response.length) return;

            const r = response[index];
            console.log(index + " : " + r.market);
            bit.selectCandles(r.market, $('#sel_candlesType').val(), $('#sel_minutes').val(), $('#sel_count').val());

            index++;
            setTimeout(callNext, 100); // 0.3초 후 다음 호출
        }

        callNext();
    }
    
    bit.selectCandles = function(market, candleType, minutes, count){	

    	const options = {method: 'GET', headers: {accept: 'application/json'}};

    	fetch('https://api.bithumb.com/v1/candles/'+candleType+'/'+minutes+'?market='+market+'&count=' + count, options)
    	  .then(response => response.json())
    	  .then(response => console.log(response))
    	  .catch(err => console.error(err));
	
    };
    
    bit.selectCaution = function(market){	

    	const options = {method: 'GET', headers: {accept: 'application/json'}};

    	fetch('https://api.bithumb.com/v1/market/virtual_asset_warning', options)
    	  .then(response => response.json())
    	  .then(response => console.log(response))
    	  .catch(err => console.error(err));
	
    };
    
    </script>
</body>

</html>